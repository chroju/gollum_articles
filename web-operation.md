ウェブオペレーション サイト運用管理の実践テクニック
=====

## 目的
* 運用エンジニアになったものの、障害時など何をすればいいかわかっていないことが多く取っ掛かりがほしい。
* 障害対応だけが運用エンジニアではないとも思う。チューニングやDevOpsの実現など、イマドキのops系の仕事を見渡したい。
* エッセイなのでザッと読みで取っ掛かりが作れればいいかなと。

## 概要

### 1章 ウェブオペレーション：キャリア
* 物理、工学的な面まで含めた幅広い知識が要求される。ユーザーグループなどで知識の交換を行うこと。
* 経験の重要性。単に年数を重ねるだけではなく障害対応などを経験すること。判断が難しい状況に立つこと。
* "未経験の人がこの分野に入ってきたときは、まずがまんしろと言いたい。しかし、この言葉を理解する前に、がまんが燃え尽きてしまうのだ。"

### 3章 インフラとアプリケーションのメトリクス
* ログもメトリクス。エラーが上がった回数をグラフ化してみたり。変更やデプロイをグラフ化したり。
* 値の加速度を見てアラートを出す。
* Ganglia開発者のマット・マッシーによる言
  * 収集、集約コストを低く保つ
  * 自動的に新しいノードを発見させる。ノード数が多くなればユニキャストが多い。
  * TCPとUDPをなぞらえたgmetadとgmond
    * gmondではすべての状態をメモリに保持する
  * メトリクス閾値を小さくしすぎてNWを混雑させないこと。Gangliaはこのあたり計算はしている。
    * 変化が大きい時だけメッセージを送る、一度とればいいデータは収集インターバルを大きくする
  * 収集したメトリクスはXMLやRSSでダンプでき、再利用しやすくなっている。

### 4章 継続的デプロイ
* 小さなサイクルでリリースを回した方が影響が低く、ロールバックも容易。
* リリース時にすぐ気付けるようなアラーム設定をすること。

### 5章 コードとしてのインフラ
* システムの自動化は、構成管理方針をコードにしたもの
* "構成管理は方針駆動"
* よいインフラサービスの10個の原則
  * モジュール化、協調性、組み立て可能、柔軟性、拡張性、繰り返し可能、宣言的、抽象化、べき当性、収束化

### 6章 監視
* MTTFやMTTRもちゃんと取ってもいいのかもしれない（KPIとして）

### 10章 開発と運用の協力と連携
* フィーチャーフラグ、機能を一発でオンオフして、サービス継続は最低限果たせるようにしておく。
* デバッグモードもオンにできるようにしておく。
* ツール、サービス、インフラをある程度共有することによる時間短縮。

### 12章 ウェブにおけるリレーショナル・データベースの戦略と戦術
* ACIDとBASE
* シャーディング

### 13章 障害を活用する：ふりかえりの技芸と科学
* 可能であれば24時間、遅くとも1w以内でのふりかえり
* 個人攻撃は避けて再発防止を念頭に
* TTR（Time to Resolve）の短縮を考える

### 16章 アジャイルインフラストラクチャ
* インフラ管理はソフトウェアを書くこと。SWの分野から学べることもあるんでは？
* この業界の技術水準は恥ずかしくなるほど低い。
* 運用は問題が起こるまでコストセンターと思われており、だから人が足りない、なのにシステムはツギハギだらけで安定性が保てず、悪循環になる。
* 構成管理、バージョン管理、自動デプロイ。内省的プロセス改善。
* 可能な限りシンプルに。関心を分離して疎結合のサービスにすることで、技術的負債を防ぐ。
* 「わずかな違いのナルシズム」、人とわずかに違う点に誇りを抱き、似た点に負の感情を抱く（フロイト）=>信頼の欠如、人同士の問題

### 17章 夜中に聞こえる奇妙な物音（と、ぐっすり眠る方法）
* フェイルオーバーのテスト！！

### 18章 日本の料理のインフラ（濱崎健吾氏）
* オフィス中央に常にモニタリング画面が表示されている。
* GitとCapistranoを用いた設定追加の自動化。
* Kickstartとpuppetでサーバーは10分程度で自動追加できる。

## 目的に対する成果
* エッセイではあるが、運用をする上での心構えや注意点が多くてためになった。
* 現状、弊社運用は駆け出しの状態なので、これらを使って点検するだけでも意味はあるのでは。
* 同時期に読んだ「サーバ/インフラを支える技術」と違って業務フローやDevOps的な部分に踏み込めた。
* 検証中だったGangliaに関して作成者の言葉が載っていた僥倖。
* CookPadがすごすぎて辛い。

## 活用方針
* Gangliaの件はフィードバックとして頭に焼きこむ。
* 現状の運用を紐解いて、頭の中でこの本と比べてみる。改善ポイントを探す。
* Cookpadの模倣は無理だが、自動化インフラの究極を目指す。
* 特に運開の分担はもっと優れた形、効率的な形がないか模索をしたい。

## 不明点
* ストレージとSQL関連はやはり飛ばしてしまったので再確認。
* デプロイや開発に近い話をマークできなかったけど、考えてみればこの本は運用向けのはずなので、そこも読むべきではあったのでは。

## 関連
* [圧倒的な技術力が求められる職種だ /「ウェブオペレーション」を読んだ - kakakakakku blog](http://kakakakakku.hatenablog.com/entry/2015/07/12/194716)
  * 圧倒的な技術力((((；ﾟДﾟ))))